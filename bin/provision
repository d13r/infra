#!/usr/bin/env bash
set -euo pipefail
cd "$(dirname "$0")/../ansible"

host=${1-}

if [[ $host = '' || $host = '--help' || $host = '-h' ]]; then
    echo "Usage: ${BIN_COMMAND-$0} HOST [ANSIBLE OPTIONS]"
    exit
fi

if [[ ! -f "provision-$host.yml" ]]; then
    echo "Host not recognised (check that ansible/provision-$host.yml exists)" 2>&1
    exit 1
fi

args=''
if [[ $host = 'wsl' ]]; then
    args='--ask-become-pass'
fi

shift

exec ../bin/ansible-playbook $args "provision-$host.yml" "$@"
