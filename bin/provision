#!/usr/bin/env bash
set -euo pipefail
cd "$(dirname "$0")/../ansible"

host=${1-}

if [[ $host = '--help' || $host = '-h' ]]; then
    echo "Usage: ${BIN_COMMAND-$0} HOST [ANSIBLE OPTIONS]"
    exit
fi

if [[ -z $host ]]; then
    host=${HOSTNAME,,}
fi

shift || true

if [[ ! -f "provision-$host.yml" ]]; then
    echo "Host not recognised (check that ansible/provision-$host.yml exists)" 2>&1
    exit 1
fi

exec ../bin/ansible-playbook "provision-$host.yml" "$@"
